<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>应急响应 | willsafeのBlog</title><meta name="author" content="willsafe"><meta name="copyright" content="willsafe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="知攻善防，遇强则强">
<meta property="og:type" content="article">
<meta property="og:title" content="应急响应">
<meta property="og:url" content="http://willsafe.github.io/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/index.html">
<meta property="og:site_name" content="willsafeのBlog">
<meta property="og:description" content="知攻善防，遇强则强">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imgxz.bizhi3.com/cont/20220811/le5ejhxsasn.jpg">
<meta property="article:published_time" content="2024-03-11T14:00:35.000Z">
<meta property="article:modified_time" content="2024-03-12T02:08:34.792Z">
<meta property="article:author" content="willsafe">
<meta property="article:tag" content="基础知识">
<meta property="article:tag" content="应急响应">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imgxz.bizhi3.com/cont/20220811/le5ejhxsasn.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://willsafe.github.io/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: willsafe","link":"链接: ","source":"来源: willsafeのBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '应急响应',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-12 10:08:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/icon.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://imgxz.bizhi3.com/cont/20220811/fll20l2e4ie.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="willsafeのBlog"></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">应急响应</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-11T14:00:35.000Z" title="发表于 2024-03-11 22:00:35">2024-03-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-12T02:08:34.792Z" title="更新于 2024-03-12 10:08:34">2024-03-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">应急响应</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>26分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="应急响应"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、应急响应"><a href="#一、应急响应" class="headerlink" title="一、应急响应"></a>一、应急响应</h1><h2 id="1-1-什么是应急响应"><a href="#1-1-什么是应急响应" class="headerlink" title="1.1 什么是应急响应"></a>1.1 什么是应急响应</h2><p>应急响应,指的是在应对突发事件或危机情况时采取的及时有效措施,以控制和减轻事件带来的影响,保障安全。<br>在检测到网络安全事件（如黑客攻击、数据泄露、系统入侵等）后，组织采取的一系列预定义的行动和程序，以最小化损失和影响，恢复正常运营，并防止未来的安全威胁。</p>
<h2 id="1-2-PDCERF模型"><a href="#1-2-PDCERF模型" class="headerlink" title="1.2 PDCERF模型"></a>1.2 PDCERF模型</h2><p><img src="https://picx.zhimg.com/70/v2-91e8da7c1f07bbe5bb963f8dc8711a90_1440w.avis?source=172ae18b&biz_tag=Post"></p>
<ul>
<li><strong>准备阶段</strong><br>准备阶段以预防为主。主要工作涉及识别机构、企业的风险，建立安全政策，建立协作体系和应急制度。按照安全政策配置安全设备和软件，为应急响应与恢复准备主机。依照网络安全措施，进行一些准备工作，例如，扫描、风险分析、打补丁等。如有条件且得到许可，可建立监控设施，建立数据汇总分析体系，制定能够实现应急响应目标的策略和规程，建立信息沟通渠道，建立能够集合起来处理突发事件的体系。</li>
</ul>
<p><em>一般现象</em></p>
<ol>
<li>业务服务功能失效</li>
<li>业务内容被明显篡改</li>
<li>系统文件丢失</li>
<li>系统崩溃、卡顿、资源不足</li>
</ol>
<hr>
<ul>
<li><strong>检测阶段</strong><br>检测阶段主要检测事件是已经发生的还是正在进行中的，以及事件产生的原因。确定事件性质和影响的严重程度，以及预计采用什么样的专用资源来修复。选择检测工具，分析异常现象，提高系统或网络行为的监控级别，估计安全事件的范围。通过汇总，查看是否发生了全网的大规模事件，从而确定应急等级及其对应的应急方案。</li>
</ul>
<hr>
<ul>
<li><strong>遏制阶段</strong><br>抑制阶段的主要任务是限制攻击&#x2F;破坏波及的范围，同时也是在降低潜在的损失。所有的抑制活动都是建立在能正确检测事件的基础上的，抑制活动必须结合检测阶段发现的安全事件的现象、性质、范围等属性，制定并实施正确的抑制策略。</li>
</ul>
<p><em>抑制策略</em></p>
<ol>
<li>从网络上断开主机或断开部分网络</li>
<li>封禁攻击来源IP</li>
<li>修改所有的防火墙和路由器的过滤规则</li>
<li>封锁或删除被攻击的登录账号</li>
<li>关闭受攻击的系统或其他相关系统的部分服务</li>
<li>完全关闭所有系统</li>
</ol>
<hr>
<ul>
<li><strong>根除阶段</strong><br>根除阶段的主要任务是通过事件分析找出根源并彻底根除，以避免攻击者再次使用相同的手段攻击系统，引发安全事件。并加强宣传，公布危害性和解决办法，呼吁用户解决终端问题。加强监测工作，发现和清理行业与重点部门问题。</li>
<li><strong>恢复阶段</strong><br>恢复阶段的主要任务是把被破坏的信息彻底还原到正常运作状态。确定使系统恢复正常的需求内容和时间表，从可信的备份介质中恢复用户数据，打开系统和应用服务，恢复系统网络连接，验证恢复系统，观察其他的扫描，探测可能表示入侵者再次侵袭的信号。一般来说，要想成功地恢复被破坏的系统，需要干净的备份系统，编制并维护系统恢复的操作手册，而且在系统重装后需要对系统进行全面的安全加固。</li>
<li><strong>总结阶段</strong><br>总结阶段的主要任务是回顾并整合应急响应过程的相关信息，进行事后分析总结和修订安全计划、政策、程序，并进行训练，以防止入侵的再次发生。基于入侵的严重性和影响，确定是否进行新的风险分析，给系统和网络资产制作一个新的目录清单。这一阶段的工作对于准备阶段工作的开展起到重要的支持作用。</li>
</ul>
<p><em>工作内容</em></p>
<ol>
<li>形成事件处理的最终报告</li>
<li>总结响应过程</li>
<li>评估应急响应人员相互沟通在事件处理上存在的缺陷</li>
</ol>
<h1 id="二、windows"><a href="#二、windows" class="headerlink" title="二、windows"></a>二、windows</h1><h2 id="2-1-系统层面"><a href="#2-1-系统层面" class="headerlink" title="2.1 系统层面"></a>2.1 系统层面</h2><h3 id="2-1-1-特殊目录"><a href="#2-1-1-特殊目录" class="headerlink" title="2.1.1 特殊目录"></a>2.1.1 特殊目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%windwos%				C:\WINDOWS</span><br><span class="line">%windwos%\system32\		C:\WINDOWS\system32\</span><br><span class="line">%temp%					C:\Users\用户\AppData\Local\Temp</span><br><span class="line">%localappdata%			C:\Users\用户\AppData\Local</span><br><span class="line">%appdata%				C:\Users\用户\AppData\Roaming</span><br></pre></td></tr></table></figure>
<h3 id="2-1-2-快捷命令"><a href="#2-1-2-快捷命令" class="headerlink" title="2.1.2 快捷命令"></a>2.1.2 快捷命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">regeidt				注册表</span><br><span class="line">taskmgr				任务管理器</span><br><span class="line">eventvwr.msc		事件查看器</span><br><span class="line">compmgmt.msc		计算机管理</span><br><span class="line">gpedit.msc			本地组策略</span><br><span class="line">taskschd			计划任务</span><br><span class="line">lusrmgr.msc			本地用户和组</span><br><span class="line">msconfig			系统配置</span><br></pre></td></tr></table></figure>
<h3 id="2-1-3-常用命令"><a href="#2-1-3-常用命令" class="headerlink" title="2.1.3 常用命令"></a>2.1.3 常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">net user 			查看用户信息</span><br><span class="line">net localgroup		查看本地用户组</span><br><span class="line">net session         查看当前会话</span><br><span class="line">net start			当前执行的服务</span><br><span class="line">net shart			查看本地共享</span><br><span class="line">net use				查看正常使用的共享</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">schtasks			查看计划任务</span><br><span class="line">sc stop 服务名		  关闭服务</span><br><span class="line">sc start 服务名	  开启服务</span><br><span class="line">sc delete 服务名	  删除服务</span><br></pre></td></tr></table></figure>
<h3 id="2-1-4-系统日志"><a href="#2-1-4-系统日志" class="headerlink" title="2.1.4 系统日志"></a>2.1.4 系统日志</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">日志路径：%SystemRoot%\System32\Winevt\Logs\System.evtx</span><br></pre></td></tr></table></figure>
<ul>
<li>事件编号<br><img src="/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/image-20240311222353521.png"></li>
</ul>
<h3 id="2-1-5-启动项"><a href="#2-1-5-启动项" class="headerlink" title="2.1.5 启动项"></a>2.1.5 启动项</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">net statistics workstation      查看系统开机时间</span><br><span class="line">schtasks /query /fo LIST /v     查看系统计划任务</span><br><span class="line">wmic startup get command,caption    查看程序启动信息</span><br><span class="line">wmic service list brief         查看主机服务信息</span><br><span class="line">eventvwr.msc                    日志查看器</span><br><span class="line">msconfig                        打开系统配置</span><br><span class="line">msinfo32                        系统信息</span><br></pre></td></tr></table></figure>
<h3 id="2-1-6-用户"><a href="#2-1-6-用户" class="headerlink" title="2.1.6 用户"></a>2.1.6 用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">方法1：</span><br><span class="line">net user            查看用户(但是看不到隐藏用户)</span><br><span class="line">    net user username   查看用户详细信息</span><br><span class="line">方法2：</span><br><span class="line">lusrmgr.msc         查看系统现用的用户(可以看到隐藏用户)</span><br><span class="line">方法3：</span><br><span class="line">regedit-&gt;HKEY_LOCAL_MACHINE-&gt;SAM-&gt;SAM-&gt;Domains-&gt;Account-&gt;Users-&gt;Names   查看全部用户信息(最真实)</span><br><span class="line">方法4：</span><br><span class="line">wmic useraccount get name,SID</span><br><span class="line"></span><br><span class="line">query user          查看当前登录系统的会话</span><br><span class="line">logoff ID           将用户踢下线</span><br><span class="line"></span><br><span class="line">net config workstation      查看当前工作环境</span><br></pre></td></tr></table></figure>
<h3 id="2-1-7-网络连接和进程"><a href="#2-1-7-网络连接和进程" class="headerlink" title="2.1.7 网络连接和进程"></a>2.1.7 网络连接和进程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">网卡信息</span><br><span class="line">ipconfig /all       查看网络信息</span><br><span class="line">systeminfo          系统信息</span><br><span class="line">regedit             打开注册表</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">网络连接情况</span><br><span class="line">netstat -ano        列出主机TCP/UDP端口连接情况</span><br><span class="line">route print         打印路由表</span><br><span class="line">REG QUERY &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;   </span><br><span class="line">查看本机网络代理配置情况</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">进程信息</span><br><span class="line">tasklist /svc       列出所有进程及其服务</span><br><span class="line">taskkill /T /F /PID 强制关闭某进程</span><br></pre></td></tr></table></figure>
<h2 id="2-2-网站层面"><a href="#2-2-网站层面" class="headerlink" title="2.2 网站层面"></a>2.2 网站层面</h2><h3 id="2-2-1-Web日志"><a href="#2-2-1-Web日志" class="headerlink" title="2.2.1 Web日志"></a>2.2.1 Web日志</h3><p>找到中间件的web⽇志，打包到本地⽅便进⾏分析。<br>利用关键字搜索或者工具筛查</p>
<h3 id="2-2-2-webshell查杀"><a href="#2-2-2-webshell查杀" class="headerlink" title="2.2.2 webshell查杀"></a>2.2.2 webshell查杀</h3><p>D盾_Web查杀：<a target="_blank" rel="noopener" href="http://www.d99net.net/index.asp">http://www.d99net.net/index.asp</a><br>河⻢ WebShell 查杀：<a target="_blank" rel="noopener" href="http://www.shellpub.com/">http://www.shellpub.com</a></p>
<h2 id="2-3-入侵排查"><a href="#2-3-入侵排查" class="headerlink" title="2.3 入侵排查"></a>2.3 入侵排查</h2><h3 id="2-3-1-账号安全"><a href="#2-3-1-账号安全" class="headerlink" title="2.3.1 账号安全"></a>2.3.1 账号安全</h3><p><strong>检查系统账号安全</strong></p>
<ol>
<li>弱口令、端口开发情况</li>
<li>查看系统用户账号(lusrmgr.msc)</li>
<li>D盾查杀注册表(是否有克隆账号)</li>
<li>日志审查(eventvwr.msc-&gt;事件查看器-&gt;windows日志-&gt;安全导出-&gt;使用Log Parser进行分析)</li>
</ol>
<h3 id="2-3-2-端口进程"><a href="#2-3-2-端口进程" class="headerlink" title="2.3.2 端口进程"></a>2.3.2 端口进程</h3><p><strong>检查异常端口、进程</strong></p>
<ol>
<li>用 netstat -ano 命令查看目前的网络连接，定位可疑的 ESTABLISHED</li>
<li>进行进程定位 tasklist | findstr “PID”</li>
<li>msinfo32-&gt;软件环境-&gt;正在运行的任务-&gt;再使用Process Explorer进行排查</li>
</ol>
<h3 id="2-3-3-启动项、计划任务、服务"><a href="#2-3-3-启动项、计划任务、服务" class="headerlink" title="2.3.3 启动项、计划任务、服务"></a>2.3.3 启动项、计划任务、服务</h3><p><strong>检查启动项、计划任务、服务自启动</strong></p>
<ol>
<li>排查启动项</li>
<li>排查注册表启动项(注册表路径如下)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\run</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce</span><br></pre></td></tr></table></figure></li>
<li>检查计划任务(cmd-&gt;schtasks.exe)</li>
<li>services.msc 查看是否有可疑自启动服务</li>
</ol>
<h3 id="2-3-4-Web-访问⽇志"><a href="#2-3-4-Web-访问⽇志" class="headerlink" title="2.3.4 Web 访问⽇志"></a>2.3.4 Web 访问⽇志</h3><ol>
<li>找到中间件的web⽇志，打包到本地⽅便进⾏分析。</li>
<li>推荐⼯具：Windows 下，推荐⽤ EmEditor 进⾏⽇志分析，⽀持⼤⽂本，搜索效率还不错。Linux 下，使⽤ Shell 命令组合查询分析。</li>
<li>工具推荐<br><a target="_blank" rel="noopener" href="https://github.com/JPCERTCC/LogonTracer">部署linux上web访问</a><br><a target="_blank" rel="noopener" href="https://www.nirsoft.net/utils/full_event_log_view.html">fulleventlogview工具分析</a></li>
</ol>
<h2 id="2-4-工具"><a href="#2-4-工具" class="headerlink" title="2.4 工具"></a>2.4 工具</h2><h3 id="2-4-1-木马病毒"><a href="#2-4-1-木马病毒" class="headerlink" title="2.4.1 木马病毒"></a>2.4.1 木马病毒</h3><ol>
<li><a target="_blank" rel="noopener" href="http://www.xuetr.com/">PCHunter</a></li>
<li><a target="_blank" rel="noopener" href="https://www.huorong.cn/">⽕绒剑</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer">Process Explorer</a></li>
<li><a target="_blank" rel="noopener" href="https://processhacker.sourceforge.io/downloads.php">processhacker</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns">autoruns</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bleepingcomputer.com/download/otl/">OTL</a></li>
<li><a target="_blank" rel="noopener" href="http://download.eset.com.cn/download/detail/?product=sysinspector">SysInspector</a></li>
</ol>
<h3 id="2-4-2-木马查杀"><a href="#2-4-2-木马查杀" class="headerlink" title="2.4.2 木马查杀"></a>2.4.2 木马查杀</h3><ol>
<li><a target="_blank" rel="noopener" href="http://devbuilds.kaspersky-labs.com/devbuilds/KVRT/latest/full/KVRT.exe(%E7%BB%BF%E2%BE%8A%E7%89%88)">卡巴斯基</a></li>
<li><a target="_blank" rel="noopener" href="http://free.drweb.ru/download+cureit+free%EF%BC%88%E6%8E%A8%E8%8D%90%E7%90%86%E7%94%B1%EF%BC%9A%E6%89%AB%E6%8F%8F%E5%BF%AB%E3%80%81%E2%BC%80%E6%AC%A1%E4%B8%8B%E8%BD%BD%E5%8F%AA%E8%83%BD%E2%BD%A41%E5%91%A8%EF%BC%8C%E6%9B%B4%E6%96%B0%E7%97%85%E6%AF%92%E5%BA%93%EF%BC%89">⼤蜘蛛</a></li>
<li><a target="_blank" rel="noopener" href="https://www.huorong.cn/">⽕绒安全软件</a></li>
<li><a target="_blank" rel="noopener" href="http://sd.360.cn/download_center.html">360杀毒</a></li>
</ol>
<h3 id="2-4-3-威胁情报"><a href="#2-4-3-威胁情报" class="headerlink" title="2.4.3 威胁情报"></a>2.4.3 威胁情报</h3><ol>
<li><a target="_blank" rel="noopener" href="http://www.cverc.org.cn/">CVERC-国家计算机病毒应急处理中⼼</a></li>
<li><a target="_blank" rel="noopener" href="https://x.threatbook.cn/">微步在线威胁情报社区</a></li>
<li><a target="_blank" rel="noopener" href="http://bbs.huorong.cn/forum-59-1.html">⽕绒安全论坛</a></li>
<li><a target="_blank" rel="noopener" href="http://bbs.duba.net/">爱毒霸社区</a></li>
<li><a target="_blank" rel="noopener" href="http://bbs.guanjia.qq.com/forum-2-1.html">腾讯电脑管家</a></li>
</ol>
<h3 id="2-4-4-在线查杀"><a href="#2-4-4-在线查杀" class="headerlink" title="2.4.4 在线查杀"></a>2.4.4 在线查杀</h3><ol>
<li><a target="_blank" rel="noopener" href="https://www.virustotal.com/">Virustotal</a></li>
<li><a target="_blank" rel="noopener" href="http://www.virscan.org/">Virscan</a></li>
<li><a target="_blank" rel="noopener" href="https://habo.qq.com/">腾讯哈勃分析系统</a></li>
<li><a target="_blank" rel="noopener" href="https://virusscan.jotti.org/">Jotti 恶意软件扫描系统</a></li>
</ol>
<h1 id="三、Linux"><a href="#三、Linux" class="headerlink" title="三、Linux"></a>三、Linux</h1><h2 id="3-1-系统层面"><a href="#3-1-系统层面" class="headerlink" title="3.1 系统层面"></a>3.1 系统层面</h2><h3 id="3-1-1-特殊目录"><a href="#3-1-1-特殊目录" class="headerlink" title="3.1.1 特殊目录"></a>3.1.1 特殊目录</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd             用户信息文件</span><br><span class="line">/etc/rc.d/rc.local      开机启动项</span><br><span class="line">/etc/init.d/            开机启动项</span><br><span class="line">/root/.ssh              root用户ssh公私钥</span><br><span class="line">/tmp                    临时目录</span><br><span class="line">/etc/hosts              本机域名解析文件</span><br><span class="line">/var/log/               日志目录</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-常用命令"><a href="#3-1-2-常用命令" class="headerlink" title="3.1.2 常用命令"></a>3.1.2 常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ls -al                  查看目录文件信息</span><br><span class="line">free -h                 内存使用率</span><br><span class="line">ps -aux|elf             进程信息</span><br><span class="line">top                     进程cpu信息</span><br><span class="line">netstat -antlp/anulp    查看网络连接信息</span><br><span class="line">ls -alh /proc/pid       查看进程(与上面的命令进行结合使用)看exe项就是执行的程序</span><br><span class="line">lsos -i:port            查询端口执行的程序</span><br><span class="line">lsof -p pid             查询进程打开的文件</span><br><span class="line">lsof -u 用户名           查询用户打开的文件</span><br><span class="line">cat /etc/passwd | cut -f 1 -d :| xargs -l &#123;&#125; crontab -l -u &#123;&#125;       查询所有用户的计划任务</span><br><span class="line">cat  /etc/crontab       计划任务</span><br><span class="line">crontab -l              计划任务</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">chkconfig               查看开机启动项目</span><br><span class="line">chkconfig --list        查看服务自启状态</span><br><span class="line">systemctl list-unit-files |grep enabled         ubuntu，centos及使用systemctl控制的系统</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">last                    查询用户登录历史记录</span><br><span class="line">lastb                   查询用户的登陆失败记录</span><br><span class="line">lastlog                 查询用户最后一次登录日志</span><br></pre></td></tr></table></figure>
<h3 id="3-1-3-系统日志位置"><a href="#3-1-3-系统日志位置" class="headerlink" title="3.1.3 系统日志位置"></a>3.1.3 系统日志位置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/var/log/messages           系统重要信息</span><br><span class="line">/var/log/auth.log           ubuntu系统</span><br><span class="line">/var/log/secure             记录授权方面信息</span><br><span class="line">/var/log/maillog            记录电子邮件日志</span><br><span class="line">/var/log/cron               计划任务日志</span><br><span class="line">/var/log/bioot.log          系统启动日志，包括自启动服务</span><br><span class="line">/var/log/dmesg              内核信息</span><br><span class="line">/var/log/bmtp               所有登录失败的日志</span><br><span class="line">/var/log/wtmp               用户每日登录和退出的永久日志</span><br><span class="line">/var/log/lastlog            记录所有用户的最近登录信息</span><br></pre></td></tr></table></figure>
<h3 id="3-1-4-用户相关"><a href="#3-1-4-用户相关" class="headerlink" title="3.1.4 用户相关"></a>3.1.4 用户相关</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">grep &quot;useradd&quot; /var/log/secure      查看是否有添加用户操作</span><br><span class="line">grep &quot;userdel&quot; /var/log/secure      查看是否有删除用户操作</span><br><span class="line">usermod -L username                 锁定用户</span><br><span class="line">userdel username                    删除用户</span><br><span class="line"></span><br><span class="line">用户命令记录</span><br><span class="line">cat /home/用户名/.bash_history</span><br><span class="line">root/.bash_profile      root用户记录</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/etc/passwd</code> 存放用户信息<br><strong>用户名:口令:用户标识号:组标识号:注释性描述:主目录:登录Shell</strong><br><img src="/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/image-20240311223936949.png"></li>
<li><code> /etc/shadow</code> 存放用户密码<br><strong>用户名：加密密码：最后一次修改时间：最小修改时间间隔：密码有效期：密码需要变更前的警告天数：密码过期后的宽限时间：账号失效时间：保留字段</strong><br><img src="/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/image-20240311224007758.png"></li>
<li>加密方式</li>
</ul>
<p>1 代表 MD5<br>2y、2a代表Blowfish<br>5 代表 SHA-256<br>6 代表 SHA-512</p>
<h3 id="3-1-5-系统日志"><a href="#3-1-5-系统日志" class="headerlink" title="3.1.5 系统日志"></a>3.1.5 系统日志</h3><ul>
<li>ubuntu<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">是否被爆破</span><br><span class="line">cat /var/log/auth.log | grep &quot;Failed password for root&quot;</span><br><span class="line"></span><br><span class="line">记录登陆的用户</span><br><span class="line">cat /var/log/auth.log | grep &quot;Accept&quot;</span><br><span class="line"></span><br><span class="line">计算登录失败的用户名及次数</span><br><span class="line">cat /var/log/auth.log | grep &quot;Failed password&quot; | perl -e &#x27;while($_=&lt;&gt;)&#123; /for(.*?)from/; print &quot;$1\n&quot;;&#125;&#x27;|sort|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">统计爆破者ip及次数</span><br><span class="line">cat /var/log/auth.log | grep &quot;Failed password for&quot; | grep &quot;root&quot; | grep -Po &#x27;(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])(\.(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d))&#123;3&#125;&#x27; |sort|uniq -c|sort -nr</span><br></pre></td></tr></table></figure></li>
<li>centos<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">定位有多少IP在爆破主机的root帐号</span><br><span class="line">grep &quot;Failed password for root&quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">定位有哪些IP在爆破</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">爆破用户名字典是什么</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|perl -e &#x27;while($_=&lt;&gt;)&#123; /for(.*?) from/; print &quot;$1\n&quot;;&#125;&#x27;|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">登录成功的IP</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">登录成功的日期、用户名、IP</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-2-网站层面"><a href="#3-2-网站层面" class="headerlink" title="3.2 网站层面"></a>3.2 网站层面</h2><h3 id="3-2-1-Web日志"><a href="#3-2-1-Web日志" class="headerlink" title="3.2.1 Web日志"></a>3.2.1 Web日志</h3><ul>
<li><strong>日志位置</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------------------------------</span><br><span class="line">Apache服务器的访问日志位于</span><br><span class="line">/var/log/apache2/access.log（在Debian/Ubuntu系统中）</span><br><span class="line">或/var/log/httpd/access_log（在RHEL/CentOS系统中）</span><br><span class="line">========================================================</span><br><span class="line">配置文件位置</span><br><span class="line">/etc/apache2/sites-available/000-default.conf（Debian/Ubuntu）</span><br><span class="line">或/etc/httpd/conf/httpd.conf（RHEL/CentOS）中查找CustomLog指令</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">Nginx的访问日志位于/var/log/nginx/access.log</span><br><span class="line">========================================================</span><br><span class="line">配置文件位置</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line">或/etc/nginx/sites-available/default中查找access_log指令</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">Lighttpd的访问日志位于/var/log/lighttpd/access.log</span><br><span class="line">========================================================</span><br><span class="line">配置文件位置</span><br><span class="line">/etc/lighttpd/lighttpd.conf</span><br><span class="line">或/etc/lighttpd/lighttpd.conf.d/accesslog.conf中查找accesslog指令。</span><br><span class="line">--------------------------------------------------------</span><br></pre></td></tr></table></figure></li>
<li>技巧<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">列出当天访问次数最多的IP命令</span><br><span class="line">cut -d- -f 1 log_file | uniq -c | sort -rn | head -20</span><br><span class="line">查看当天有多少个IP访问</span><br><span class="line">awk &#x27;&#123;print $1&#125;&#x27; log_file|sort|uniq|wc -l</span><br><span class="line">查看某⼀个⻚⾯被访问的次数</span><br><span class="line">grep &quot;/index.php&quot; log_file | wc -l</span><br><span class="line">查看每⼀个IP访问了多少个⻚⾯</span><br><span class="line">awk &#x27;&#123;++S[$1]&#125; END &#123;for (a in S) print a,S[a]&#125;&#x27; log_file</span><br><span class="line">将每个IP访问的⻚⾯数进⾏从⼩到⼤排序</span><br><span class="line">awk &#x27;&#123;++S[$1]&#125; END &#123;for (a in S) print S[a],a&#125;&#x27; log_file | sort -n</span><br><span class="line">查看某⼀个IP访问了哪些⻚⾯</span><br><span class="line">grep ^111.111.111.111 log_file| awk &#x27;&#123;print $1,$7&#125;&#x27;</span><br><span class="line">去掉搜索引擎统计当天的⻚⾯</span><br><span class="line">awk &#x27;&#123;print $12,$1&#125;&#x27; log_file | grep ^\&quot;Mozilla | awk &#x27;&#123;print $2&#125;&#x27; |sort | uniq | wc -l</span><br><span class="line">查看2018年6⽉21⽇14时这⼀个⼩时内有多少IP访问</span><br><span class="line">awk &#x27;&#123;print $4,$1&#125;&#x27; log_file | grep 21/Jun/2018:14 | awk &#x27;&#123;print $2&#125;&#x27;| sort | uniq | wc</span><br><span class="line">-l</span><br><span class="line">========================================================</span><br><span class="line">统计爬虫</span><br><span class="line">grep -E &#x27;Googlebot|Baiduspider&#x27; /www/logs/access.2019-02-23.log | awk &#x27;&#123; print $1 &#125;&#x27; |</span><br><span class="line">sort | uniq</span><br><span class="line">统计浏览器</span><br><span class="line">cat /www/logs/access.2019-02-23.log | grep -v -E</span><br><span class="line">&#x27;MSIE|Firefox|Chrome|Opera|Safari|Gecko|Maxthon&#x27; | sort | uniq -c | sort -r -n | head -</span><br><span class="line">n 100</span><br><span class="line">统计ip</span><br><span class="line">grep &#x27;23/May/2019&#x27; /www/logs/access.2019-02-23.log | awk &#x27;&#123;print $1&#125;&#x27; | awk -F&#x27;.&#x27;</span><br><span class="line">&#x27;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&quot;.&quot;$4&#125;&#x27; | sort | uniq -c | sort -r -n | head -n 10</span><br><span class="line">统计网段</span><br><span class="line">cat /www/logs/access.2019-02-23.log | awk &#x27;&#123;print $1&#125;&#x27; | awk -F&#x27;.&#x27; &#x27;&#123;print</span><br><span class="line">$1&quot;.&quot;$2&quot;.&quot;$3&quot;.0&quot;&#125;&#x27; | sort | uniq -c | sort -r -n | head -n 200 </span><br><span class="line">统计域名</span><br><span class="line">cat /www/logs/access.2019-02-23.log |awk &#x27;&#123;print $2&#125;&#x27;|sort|uniq -c|sort -rn|more </span><br><span class="line">请求状态码</span><br><span class="line">cat /www/logs/access.2019-02-23.log |awk &#x27;&#123;print $9&#125;&#x27;|sort|uniq -c|sort -rn|more</span><br><span class="line">URL 统计</span><br><span class="line">cat /www/logs/access.2019-02-23.log |awk &#x27;&#123;print $7&#125;&#x27;|sort|uniq -c|sort -rn|more </span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-2-2-Webshell查杀"><a href="#3-2-2-Webshell查杀" class="headerlink" title="3.2.2 Webshell查杀"></a>3.2.2 Webshell查杀</h3><ol>
<li><a target="_blank" rel="noopener" href="http://www.d99net.net/">D盾</a></li>
<li><a target="_blank" rel="noopener" href="https://www.shellpub.com/">河马</a></li>
<li><a target="_blank" rel="noopener" href="https://stack.chaitin.com/security-challenge/webshell/index">牧云</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/chaitin/cloudwalker">牧云下载地址</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jvoisin/php-malware-finder">PHP Malware Finder</a><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">自动化</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">https://github.com/grayddq/GScan</span><br><span class="line">https://github.com/al0ne/LinuxCheck</span><br><span class="line">https://github.com/ppabc/security_check</span><br><span class="line">https://github.com/T0xst/linux</span><br><span class="line">https://github.com/P4ck/Emergency</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>恶意函数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHP：eval(、system(、assert(</span><br><span class="line">JSP：getRunTime(、 FileOutputStream(</span><br><span class="line">ASP：eval(、execute(、 ExecuteGlobal（</span><br></pre></td></tr></table></figure></li>
<li>脚本<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------机器名-------------------------&quot;</span></span><br><span class="line">hostname</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看用户信息-------------------------&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd |grep -v nologin |grep -v /bin/false</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看登录信息-------------------------&quot;</span></span><br><span class="line">w</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看正在连接的IP-------------------------&quot;</span></span><br><span class="line">netstat -antlp |grep ESTABLISHED</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看对外监听的端口-------------------------&quot;</span></span><br><span class="line">netstat -antlp |grep LISTEN | grep -v 127.0.0.1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看历史登录信息-------------------------&quot;</span></span><br><span class="line">last -F -n 10</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看安全日志中登录成功信息-------------------------&quot;</span></span><br><span class="line">grep <span class="string">&quot;Accepted &quot;</span> /var/log/secure | awk <span class="string">&#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看历史命令，查找外联-------------------------&quot;</span></span><br><span class="line"><span class="built_in">history</span> | grep -E <span class="string">&quot;([0-9]&#123;1,3&#125;[\.])&#123;3&#125;[0-9]&#123;1,3&#125;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查看计划任务-------------------------&quot;</span></span><br><span class="line">crontab -l</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------查找隐藏文件-------------------------&quot;</span></span><br><span class="line">find / ! -path <span class="string">&quot;/proc/*&quot;</span> ! -path <span class="string">&quot;/usr/*&quot;</span> ! -path <span class="string">&quot;/var/*&quot;</span> ! -path <span class="string">&quot;/sys/*&quot;</span> -name <span class="string">&quot;.*&quot;</span> -<span class="built_in">print</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;-------------------------其他·提示-------------------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看用户进程：lsof -u hack&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看端口占用：lsof -i:8888&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看公钥信息：~/.ssh/id_dsa.pub&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;查看进程：ps -aux&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-3-勒索"><a href="#3-3-勒索" class="headerlink" title="3.3 勒索"></a>3.3 勒索</h2><ul>
<li><strong>分析平台</strong></li>
</ul>
<ol>
<li><a target="_blank" rel="noopener" href="https://edr.sangfor.com.cn/#/information/ransom_search">深信服</a></li>
<li><a target="_blank" rel="noopener" href="https://lesuobingdu.360.cn/">360</a></li>
<li><a target="_blank" rel="noopener" href="https://lesuobingdu.qianxin.com/">奇安信</a></li>
<li><a target="_blank" rel="noopener" href="https://guanjia.qq.com/pr/ls/">腾讯</a></li>
<li><a target="_blank" rel="noopener" href="https://lesuo.venuseye.com.cn/">VenusEye</a></li>
</ol>
<h2 id="3-4-入侵排查"><a href="#3-4-入侵排查" class="headerlink" title="3.4 入侵排查"></a>3.4 入侵排查</h2><h3 id="3-4-1-账号安全"><a href="#3-4-1-账号安全" class="headerlink" title="3.4.1 账号安全"></a>3.4.1 账号安全</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">⽤户信息⽂件 /etc/passwd</span><br><span class="line">⽤户名：密码：⽤户ID：组ID：⽤户说明：家⽬录：登陆之后的 shell</span><br><span class="line">注意：⽆密码只允许本机登陆，远程不允许登陆</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">密码文件 /etc/shadow</span><br><span class="line">⽤户名：加密密码：密码最后⼀次修改⽇期：两次密码的修改时间间隔：密码有效期：密码修改到期到的警告天数：密</span><br><span class="line">码过期之后的宽限天数：账号失效时间：保留</span><br><span class="line"></span><br><span class="line">who 查看当前登录⽤户（tty 本地登陆 pts 远程登录）</span><br><span class="line">w 查看系统信息，想知道某⼀时刻⽤户的⾏为</span><br><span class="line">uptime 查看登陆多久、多少⽤户，负载状态</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">1、查询特权⽤户特权⽤户(uid 为0)</span><br><span class="line">[root@localhost ~]# awk -F: &#x27;$3==0&#123;print $1&#125;&#x27; /etc/passwd</span><br><span class="line">2、查询可以远程登录的帐号信息</span><br><span class="line">[root@localhost ~]# awk &#x27;/\$1|\$6/&#123;print $1&#125;&#x27; /etc/shadow</span><br><span class="line">3、除root帐号外，其他帐号是否存在sudo权限。如⾮管理需要，普通帐号应删除sudo权限</span><br><span class="line">[root@localhost ~]# more /etc/sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL=(ALL)&quot;</span><br><span class="line">4、禁⽤或删除多余及可疑的帐号</span><br><span class="line"> usermod -L user 禁⽤帐号，帐号⽆法登录，/etc/shadow 第⼆栏为 ! 开头</span><br><span class="line"> userdel user 删除 user ⽤户</span><br><span class="line"> userdel -r user 将删除 user ⽤户，并且将 /home ⽬录下的 user ⽬录⼀并删除</span><br></pre></td></tr></table></figure>
<h3 id="3-4-2-历史命令"><a href="#3-4-2-历史命令" class="headerlink" title="3.4.2 历史命令"></a>3.4.2 历史命令</h3><p>history<br>.bash_history文件<br>进⼊⽤户⽬录下，导出历史命令。<br>cat .bash_history &gt;&gt; history.txt</p>
<h3 id="3-4-3-端口信息"><a href="#3-4-3-端口信息" class="headerlink" title="3.4.3 端口信息"></a>3.4.3 端口信息</h3><p>netstat -antlp | more<br>查看下 pid 所对应的进程⽂件路径，<br>运⾏ ls -l &#x2F;proc&#x2F;$PID&#x2F;exe 或 file &#x2F;proc&#x2F;$PID&#x2F;exe（$PID为对应的pid号）</p>
<h3 id="3-4-4-进程信息"><a href="#3-4-4-进程信息" class="headerlink" title="3.4.4 进程信息"></a>3.4.4 进程信息</h3><p><code>ps -aux | grep pid</code><br><code>ps -elf | grep pid</code></p>
<h3 id="3-4-5-开机启动项"><a href="#3-4-5-开机启动项" class="headerlink" title="3.4.5 开机启动项"></a>3.4.5 开机启动项</h3><p><img src="/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/image-20240311225154499.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">查看运⾏级别命令 runlevel</span><br><span class="line">系统默认允许级别</span><br><span class="line">vi /etc/inittab</span><br><span class="line"><span class="built_in">id</span>=3：initdefault <span class="comment">#系统开机后直接进⼊哪个运⾏级别</span></span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">开机启动配置⽂件</span><br><span class="line">/etc/rc.local</span><br><span class="line">/etc/rc.d/rc[0~6].d</span><br><span class="line"></span><br><span class="line">例⼦：当我们需要开机启动⾃⼰的脚本时，只需要将可执⾏脚本丢在 /etc/init.d ⽬录下，然后在 /etc/rc.d/rc*.d ⽂件中建⽴软链接即可。</span><br><span class="line">此中的 * 代表 0,1,2,3,4,5,6 这七个等级</span><br><span class="line">软连接：<span class="built_in">ln</span> -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh</span><br><span class="line">此处sshd是具体服务的脚本⽂件，S100ssh是其软链接，S开头代表加载时⾃启动；如果是K开头的脚本⽂件，代</span><br><span class="line">表运⾏级别加载时需要关闭的。</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">启动项⽂件</span><br><span class="line">more /etc/rc.local</span><br><span class="line">/etc/rc.d/rc[0~6].d</span><br><span class="line"><span class="built_in">ls</span> -l /etc/rc.d/rc3.d/</span><br></pre></td></tr></table></figure>
<h3 id="3-4-6-检查定时任务"><a href="#3-4-6-检查定时任务" class="headerlink" title="3.4.6 检查定时任务"></a>3.4.6 检查定时任务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">利⽤ crontab 创建计划任务</span><br><span class="line">crontab -l 列出某个⽤户cron服务的详细内容</span><br><span class="line">Tips：默认编写的crontab⽂件会保存在 (/var/spool/cron/⽤户名 例如: /var/spool/cron/root</span><br><span class="line">crontab -r 删除每个⽤户cront任务(谨慎：删除所有的计划任务)</span><br><span class="line">crontab -e 使⽤编辑器编辑当前的crontab⽂件</span><br><span class="line">如：*/1 * * * * <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> &gt;&gt; /tmp/test.txt 每分钟写⼊⽂件</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">利⽤ anacron 命令实现异步定时任务调度</span><br><span class="line">例如：</span><br><span class="line">每天运⾏ /home/backup.sh 脚本：</span><br><span class="line">vi /etc/anacrontab</span><br><span class="line">@daily 10 example.daily /bin/bash /home/backup.sh</span><br><span class="line">当机器在 backup.sh 期望被运⾏时是关机的，anacron会在机器开机⼗分钟之后运⾏它，⽽不⽤再等待7天。</span><br><span class="line">    </span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">重点关注以下目录</span><br><span class="line">/var/spool/cron/*</span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/cron.d/*</span><br><span class="line">/etc/cron.daily/*</span><br><span class="line">/etc/cron.hourly/*</span><br><span class="line">/etc/cron.monthly/*</span><br><span class="line">/etc/cron.weekly/</span><br><span class="line">/etc/anacrontab</span><br><span class="line">/var/spool/anacron/*</span><br><span class="line">more /etc/cron.daily/* 查看⽬录下所有文件</span><br></pre></td></tr></table></figure>
<h3 id="3-4-7-检查服务"><a href="#3-4-7-检查服务" class="headerlink" title="3.4.7 检查服务"></a>3.4.7 检查服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">服务⾃启动</span><br><span class="line">第⼀种修改⽅法：</span><br><span class="line">chkconfig [--level 运⾏级别] [独⽴服务名] [on|off]</span><br><span class="line">chkconfig –level 2345 httpd on 开启⾃启动</span><br><span class="line">chkconfig httpd on （默认level是2345）</span><br><span class="line"></span><br><span class="line">第二种修改⽅法：</span><br><span class="line">修改 /etc/re.d/rc.local ⽂件 </span><br><span class="line">加⼊ /etc/init.d/httpd start</span><br><span class="line"></span><br><span class="line">第三种修改⽅法：</span><br><span class="line">使⽤ ntsysv 命令管理⾃启动，可以管理独⽴服务和 xinetd 服务。</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">查询已安装的服务：</span><br><span class="line">RPM 包安装的服务</span><br><span class="line">chkconfig --list 查看服务⾃启动状态，可以看到所有的RPM包安装的服务</span><br><span class="line">ps aux | grep crond 查看当前服务</span><br><span class="line"></span><br><span class="line">系统在3与5级别下的启动项</span><br><span class="line">中⽂环境</span><br><span class="line">chkconfig --list | grep &quot;3:启⽤\|5:启⽤&quot;</span><br><span class="line">英⽂环境</span><br><span class="line">chkconfig --list | grep &quot;3:on\|5:on&quot;</span><br><span class="line"></span><br><span class="line">源码包安装的服务</span><br><span class="line">查看服务安装位置 ，⼀般是在/user/local/</span><br><span class="line">service httpd start</span><br><span class="line">搜索/etc/rc.d/init.d/ 查看是否存在</span><br></pre></td></tr></table></figure>
<h3 id="3-4-8-检查异常⽂件"><a href="#3-4-8-检查异常⽂件" class="headerlink" title="3.4.8 检查异常⽂件"></a>3.4.8 检查异常⽂件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、查看敏感⽬录，如/tmp⽬录下的⽂件，同时注意隐藏⽂件夹，以&quot;..&quot;为名的⽂件夹具有隐藏属性</span><br><span class="line">2、得到发现WEBSHELL、远控⽊⻢的创建时间，如何找出同⼀时间范围内创建的⽂件？</span><br><span class="line">可以使⽤find命令来查找，如 find /opt -iname &quot;*&quot; -atime 1 -type f 找出 /opt 下⼀天前访问过的⽂件</span><br><span class="line">3、针对可疑⽂件可以使⽤ stat 进⾏创建修改时间</span><br></pre></td></tr></table></figure>
<h3 id="3-4-9-检查系统⽇志"><a href="#3-4-9-检查系统⽇志" class="headerlink" title="3.4.9 检查系统⽇志"></a>3.4.9 检查系统⽇志</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">⽇志默认存放位置：/var/log/</span><br><span class="line">查看⽇志配置情况：more /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line">登录失败记录：/var/log/btmp                #lastb</span><br><span class="line">最后⼀次登录：/var/log/lastlog             #lastlog</span><br><span class="line">登录成功记录: /var/log/wtmp               #last</span><br><span class="line">登录⽇志记录：/var/log/secure </span><br><span class="line">⽬前登录⽤户信息：/var/run/utmp            #w、who、users</span><br><span class="line">历史命令记录：history</span><br><span class="line">仅清理当前⽤户： history -c</span><br></pre></td></tr></table></figure>
<ul>
<li>日志路径<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;var&#x2F;log&#x2F;cron</td>
<td>记录了系统定时任务相关的⽇志</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;cups</td>
<td>记录打印信息的⽇志</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;dmesg</td>
<td>记录了系统在开机时内核⾃检的信息，也可以使⽤dmesg命令直接查看内核⾃检信息</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;mailog</td>
<td>记录邮件信息</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;message</td>
<td>记录系统重要信息的⽇志。这个⽇志⽂件中会记录Linux系统的绝⼤多数重要信息，如 果系统出现问题时，⾸先要检查的就应该是这个⽇志⽂件</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;btmp</td>
<td>记录错误登录⽇志，这个⽂件是⼆进制⽂件，不能直接vi查看，⽽要使⽤lastb命令查 看</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;lastlog</td>
<td>记录系统中所有⽤户最后⼀次登录时间的⽇志，这个⽂件是⼆进制⽂件，不能直接vi， ⽽要使⽤lastlog命令查看</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;wtmp</td>
<td>永久记录所有⽤户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样 这个⽂件也是⼀个⼆进制⽂件，不能直接vi，⽽需要使⽤last命令来查看</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;utmp</td>
<td>记录当前已经登录的⽤户信息，这个⽂件会随着⽤户的登录和注销不断变化，只记录 当前登录⽤户的信息。同样这个⽂件不能直接vi，⽽要使⽤w,who,users等命令来查询</td>
</tr>
<tr>
<td>&#x2F;var&#x2F;log&#x2F;secure</td>
<td>记录验证和授权⽅⾯的信息，只要涉及账号和密码的程序都会记录，⽐如SSH登录， su切换⽤户，sudo授权，甚⾄添加⽤户和修改⽤户密码都会记录在这个⽇志⽂件中</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="3-4-10-日志分析的技巧"><a href="#3-4-10-日志分析的技巧" class="headerlink" title="3.4.10 日志分析的技巧"></a>3.4.10 日志分析的技巧</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1、定位有多少IP在爆破主机的root帐号：</span><br><span class="line">grep &quot;Failed password for root&quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c |</span><br><span class="line">sort -nr | more</span><br><span class="line"></span><br><span class="line">2.定位有哪些IP在爆破：</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-</span><br><span class="line">9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.</span><br><span class="line">(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">3.爆破⽤户名字典是什么？</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|perl -e &#x27;while($_=&lt;&gt;)&#123; /for(.*?) from/; print</span><br><span class="line">&quot;$1\n&quot;;&#125;&#x27;|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">4、登录成功的IP有哪些： </span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">5.登录成功的⽇期、⽤户名、IP：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="3-5-工具"><a href="#3-5-工具" class="headerlink" title="3.5 工具"></a>3.5 工具</h2><h3 id="3-5-1-木马查杀"><a href="#3-5-1-木马查杀" class="headerlink" title="3.5.1 木马查杀"></a>3.5.1 木马查杀</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.chkrootkit </span><br><span class="line">⽹址：http://www.chkrootkit.org</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">使⽤⽅法：</span><br><span class="line">wget ftp://ftp.pangeia.com.br/pub/seg/pac/chkrootkit.tar.gz</span><br><span class="line">tar zxvf chkrootkit.tar.gz</span><br><span class="line">cd chkrootkit-0.52</span><br><span class="line">make sense</span><br><span class="line">#编译完成没有报错的话执⾏检查</span><br><span class="line">./chkrootkit</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">2.rkhunter</span><br><span class="line">⽹址：http://rkhunter.sourceforge.net</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">使⽤⽅法：</span><br><span class="line">Wget https://nchc.dl.sourceforge.net/project/rkhunter/rkhunter/1.4.4/rkhunter-</span><br><span class="line">1.4.4.tar.gz</span><br><span class="line">tar -zxvf rkhunter-1.4.4.tar.gz</span><br><span class="line">cd rkhunter-1.4.4</span><br><span class="line">./installer.sh --install</span><br><span class="line">rkhunter -c</span><br></pre></td></tr></table></figure>
<h3 id="3-5-2-病毒查杀"><a href="#3-5-2-病毒查杀" class="headerlink" title="3.5.2 病毒查杀"></a>3.5.2 病毒查杀</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">1. Clamav</span><br><span class="line">⽹址：http://www.clamav.net/download.html</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">方法1：</span><br><span class="line">1、安装 zlib：</span><br><span class="line">wget http://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.7/zlib-1.2.7.tar.gz</span><br><span class="line">tar -zxvf zlib-1.2.7.tar.gz</span><br><span class="line">cd zlib-1.2.7</span><br><span class="line">#安装⼀下gcc编译环境： yum install gcc</span><br><span class="line">CFLAGS=&quot;-O3 -fPIC&quot; ./configure --prefix= /usr/local/zlib/</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">2、添加⽤户组 clamav 和组成员 clamav：</span><br><span class="line">groupadd clamav</span><br><span class="line">useradd -g clamav -s /bin/false -c &quot;Clam AntiVirus&quot; clamav</span><br><span class="line">3、安装 Clamav</span><br><span class="line">tar –zxvf clamav-0.97.6.tar.gz</span><br><span class="line">cd clamav-0.97.6</span><br><span class="line">./configure --prefix=/opt/clamav --disable-clamav -with-zlib=/usr/local/zlib</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">4、配置 Clamav</span><br><span class="line">mkdir /opt/clamav/logs</span><br><span class="line">mkdir /opt/clamav/updata</span><br><span class="line">touch /opt/clamav/logs/freshclam.log</span><br><span class="line">touch /opt/clamav/logs/clamd.log</span><br><span class="line">cd /opt/clamav/logs</span><br><span class="line">chown clamav:clamav clamd.log</span><br><span class="line">chown clamav:clamav freshclam.log</span><br><span class="line">5、ClamAV 使⽤：</span><br><span class="line">/opt/clamav/bin/freshclam 升级病毒库</span><br><span class="line">./clamscan –h 查看相应的帮助信息</span><br><span class="line">./clamscan -r /home 扫描所有⽤户的主⽬录就使⽤</span><br><span class="line">./clamscan -r --bell -i /bin 扫描bin⽬录并且显示有问题的⽂件的扫描结果</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">方法2：</span><br><span class="line">#安装</span><br><span class="line">yum install -y clamav</span><br><span class="line">#更新病毒库</span><br><span class="line">freshclam</span><br><span class="line">#扫描⽅法</span><br><span class="line">clamscan -r /etc --max-dir-recursion=5 -l /root/etcclamav.log</span><br><span class="line">clamscan -r /bin --max-dir-recursion=5 -l /root/binclamav.log</span><br><span class="line">clamscan -r /usr --max-dir-recursion=5 -l /root/usrclamav.log</span><br><span class="line">#扫描并杀毒</span><br><span class="line">clamscan -r --remove /usr/bin/bsd-port</span><br><span class="line">clamscan -r --remove /usr/bin/</span><br><span class="line">clamscan -r --remove /usr/local/zabbix/sbin</span><br><span class="line">#查看⽇志发现</span><br><span class="line">cat /root/usrclamav.log |grep FOUND</span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-webshell查杀"><a href="#3-5-3-webshell查杀" class="headerlink" title="3.5.3 webshell查杀"></a>3.5.3 webshell查杀</h3><ol>
<li><a target="_blank" rel="noopener" href="https://www.shellpub.com/">河马</a></li>
<li><a target="_blank" rel="noopener" href="http://tools.bugscaner.com/killwebshell/">在线webshell查杀</a></li>
<li><a target="_blank" rel="noopener" href="http://www.shelldetector.com/">Web Shell Detector</a></li>
</ol>
<h3 id="3-5-4-RPM-check-检查"><a href="#3-5-4-RPM-check-检查" class="headerlink" title="3.5.4 RPM check 检查"></a>3.5.4 RPM check 检查</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">系统完整性可以通过rpm⾃带的-Va来校验检查所有的rpm软件包，查看哪些命令是否被替换了：</span><br><span class="line">./rpm -Va &gt; rpm.log</span><br><span class="line">如果⼀切均校验正常将不会产⽣任何输出，如果有不⼀致的地⽅，就会显示出来，输出格式是8位⻓字符串，每个</span><br><span class="line">字符都⽤以表示⽂件与RPM数据库中⼀种属性的⽐较结果 ，如果是. (点) 则表示测试通过。</span><br><span class="line"></span><br><span class="line">验证内容中的8个信息的具体内容如下：</span><br><span class="line"> S ⽂件⼤⼩是否改变</span><br><span class="line"> M ⽂件的类型或⽂件的权限（rwx）是否被改变</span><br><span class="line"> 5 ⽂件MD5校验是否改变（可以看成⽂件内容是否改变）</span><br><span class="line"> D 设备中，从代码是否改变</span><br><span class="line"> L ⽂件路径是否改变</span><br><span class="line"> U ⽂件的属主（所有者）是否改变</span><br><span class="line"> G ⽂件的属组是否改变</span><br><span class="line"> T ⽂件的修改时间是否改变</span><br><span class="line"></span><br><span class="line">如果命令被替换了，如果还原回来：</span><br><span class="line">⽂件提取还原案例：</span><br><span class="line">rpm -qf /bin/ls 查询 ls 命令属于哪个软件包</span><br><span class="line">mv /bin/ls /tmp 先把 ls 转移到 tmp ⽬录下，造成 ls 命令丢失的假象</span><br><span class="line">rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls 提取 rpm</span><br><span class="line">包中 ls 命令到当前⽬录的 /bin/ls 下</span><br><span class="line">cp /root/bin/ls /bin/ 把 ls 命令复制到 /bin/ ⽬录 修复⽂件丢失</span><br></pre></td></tr></table></figure>
<h3 id="3-5-5-Linux安全检查脚本"><a href="#3-5-5-Linux安全检查脚本" class="headerlink" title="3.5.5 Linux安全检查脚本"></a>3.5.5 Linux安全检查脚本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/grayddq/GScan</span><br><span class="line">https://github.com/ppabc/security_check</span><br><span class="line">https://github.com/T0xst/linux</span><br></pre></td></tr></table></figure>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43650289/article/details/113757559">应急响应-PDCERF 方法03-CSDN博客</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://willsafe.github.io">willsafe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://willsafe.github.io/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">http://willsafe.github.io/2024/03/11/应急响应/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://willsafe.github.io" target="_blank">willsafeのBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">基础知识</a><a class="post-meta__tags" href="/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">应急响应</a></div><div class="post_share"><div class="social-share" data-image="https://imgxz.bizhi3.com/cont/20220811/le5ejhxsasn.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/03/19/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-2/" title="红日靶场(2)"><img class="cover" src="https://imgxz.bizhi3.com/cont/20220810/5pj1tankwf0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">红日靶场(2)</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/07/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-1/" title="红日靶场(1)"><img class="cover" src="https://www.bizhi3.com/uploads/ueditor/image/20220709/1657348971119782.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">红日靶场(1)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/12/13/Windows-Linux/" title="Windows&amp;&amp;Linux"><img class="cover" src="https://pic.pngsucai.com/00/87/37/c4f6b7b5f8fb1928.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-13</div><div class="title">Windows&amp;&amp;Linux</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">willsafe</div><div class="author-info__description">如果你赶不上凌晨5点的日出,不妨看看傍晚6点的夕阳</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/willsafe"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/img/qq.png" target="_blank" title="QQ"><i class="iconfont icon-qq"></i></a><a class="social-icon" href="/img/wechat.png" target="_blank" title="微信"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="/img/github.png" target="_blank" title="Github"><i class="iconfont icon-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94"><span class="toc-text">一、应急响应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94"><span class="toc-text">1.1 什么是应急响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-PDCERF%E6%A8%A1%E5%9E%8B"><span class="toc-text">1.2 PDCERF模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81windows"><span class="toc-text">二、windows</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%B3%BB%E7%BB%9F%E5%B1%82%E9%9D%A2"><span class="toc-text">2.1 系统层面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E7%89%B9%E6%AE%8A%E7%9B%AE%E5%BD%95"><span class="toc-text">2.1.1 特殊目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E5%BF%AB%E6%8D%B7%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1.2 快捷命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1.3 常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97"><span class="toc-text">2.1.4 系统日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-text">2.1.5 启动项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-6-%E7%94%A8%E6%88%B7"><span class="toc-text">2.1.6 用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-7-%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E5%92%8C%E8%BF%9B%E7%A8%8B"><span class="toc-text">2.1.7 网络连接和进程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E7%BD%91%E7%AB%99%E5%B1%82%E9%9D%A2"><span class="toc-text">2.2 网站层面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-Web%E6%97%A5%E5%BF%97"><span class="toc-text">2.2.1 Web日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-webshell%E6%9F%A5%E6%9D%80"><span class="toc-text">2.2.2 webshell查杀</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5"><span class="toc-text">2.3 入侵排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E8%B4%A6%E5%8F%B7%E5%AE%89%E5%85%A8"><span class="toc-text">2.3.1 账号安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E7%AB%AF%E5%8F%A3%E8%BF%9B%E7%A8%8B"><span class="toc-text">2.3.2 端口进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E5%90%AF%E5%8A%A8%E9%A1%B9%E3%80%81%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E3%80%81%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.3.3 启动项、计划任务、服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-Web-%E8%AE%BF%E9%97%AE%E2%BD%87%E5%BF%97"><span class="toc-text">2.3.4 Web 访问⽇志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%B7%A5%E5%85%B7"><span class="toc-text">2.4 工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E6%9C%A8%E9%A9%AC%E7%97%85%E6%AF%92"><span class="toc-text">2.4.1 木马病毒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E6%9C%A8%E9%A9%AC%E6%9F%A5%E6%9D%80"><span class="toc-text">2.4.2 木马查杀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5"><span class="toc-text">2.4.3 威胁情报</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-4-%E5%9C%A8%E7%BA%BF%E6%9F%A5%E6%9D%80"><span class="toc-text">2.4.4 在线查杀</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Linux"><span class="toc-text">三、Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E7%B3%BB%E7%BB%9F%E5%B1%82%E9%9D%A2"><span class="toc-text">3.1 系统层面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E7%89%B9%E6%AE%8A%E7%9B%AE%E5%BD%95"><span class="toc-text">3.1.1 特殊目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">3.1.2 常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E4%BD%8D%E7%BD%AE"><span class="toc-text">3.1.3 系统日志位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-%E7%94%A8%E6%88%B7%E7%9B%B8%E5%85%B3"><span class="toc-text">3.1.4 用户相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97"><span class="toc-text">3.1.5 系统日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E7%BD%91%E7%AB%99%E5%B1%82%E9%9D%A2"><span class="toc-text">3.2 网站层面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-Web%E6%97%A5%E5%BF%97"><span class="toc-text">3.2.1 Web日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-Webshell%E6%9F%A5%E6%9D%80"><span class="toc-text">3.2.2 Webshell查杀</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%8B%92%E7%B4%A2"><span class="toc-text">3.3 勒索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5"><span class="toc-text">3.4 入侵排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E8%B4%A6%E5%8F%B7%E5%AE%89%E5%85%A8"><span class="toc-text">3.4.1 账号安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E5%8E%86%E5%8F%B2%E5%91%BD%E4%BB%A4"><span class="toc-text">3.4.2 历史命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-%E7%AB%AF%E5%8F%A3%E4%BF%A1%E6%81%AF"><span class="toc-text">3.4.3 端口信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-text">3.4.4 进程信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-5-%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-text">3.4.5 开机启动项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-6-%E6%A3%80%E6%9F%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-text">3.4.6 检查定时任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-7-%E6%A3%80%E6%9F%A5%E6%9C%8D%E5%8A%A1"><span class="toc-text">3.4.7 检查服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-8-%E6%A3%80%E6%9F%A5%E5%BC%82%E5%B8%B8%E2%BD%82%E4%BB%B6"><span class="toc-text">3.4.8 检查异常⽂件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-9-%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E2%BD%87%E5%BF%97"><span class="toc-text">3.4.9 检查系统⽇志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-10-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%9A%84%E6%8A%80%E5%B7%A7"><span class="toc-text">3.4.10 日志分析的技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E5%B7%A5%E5%85%B7"><span class="toc-text">3.5 工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-1-%E6%9C%A8%E9%A9%AC%E6%9F%A5%E6%9D%80"><span class="toc-text">3.5.1 木马查杀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-2-%E7%97%85%E6%AF%92%E6%9F%A5%E6%9D%80"><span class="toc-text">3.5.2 病毒查杀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-3-webshell%E6%9F%A5%E6%9D%80"><span class="toc-text">3.5.3 webshell查杀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-4-RPM-check-%E6%A3%80%E6%9F%A5"><span class="toc-text">3.5.4 RPM check 检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-5-Linux%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%E8%84%9A%E6%9C%AC"><span class="toc-text">3.5.5 Linux安全检查脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-text">参考文章</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/03/19/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-2/" title="红日靶场(2)"><img src="https://imgxz.bizhi3.com/cont/20220810/5pj1tankwf0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="红日靶场(2)"/></a><div class="content"><a class="title" href="/2024/03/19/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-2/" title="红日靶场(2)">红日靶场(2)</a><time datetime="2024-03-19T02:23:26.000Z" title="发表于 2024-03-19 10:23:26">2024-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="应急响应"><img src="https://imgxz.bizhi3.com/cont/20220811/le5ejhxsasn.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应急响应"/></a><div class="content"><a class="title" href="/2024/03/11/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="应急响应">应急响应</a><time datetime="2024-03-11T14:00:35.000Z" title="发表于 2024-03-11 22:00:35">2024-03-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/07/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-1/" title="红日靶场(1)"><img src="https://www.bizhi3.com/uploads/ueditor/image/20220709/1657348971119782.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="红日靶场(1)"/></a><div class="content"><a class="title" href="/2024/03/07/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA-1/" title="红日靶场(1)">红日靶场(1)</a><time datetime="2024-03-07T06:18:41.000Z" title="发表于 2024-03-07 14:18:41">2024-03-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/04/CFS%E4%B8%89%E5%B1%82%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="CFS三层内网渗透"><img src="https://cdn.pixabay.com/photo/2014/02/13/07/28/security-265130_1280.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CFS三层内网渗透"/></a><div class="content"><a class="title" href="/2024/03/04/CFS%E4%B8%89%E5%B1%82%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" title="CFS三层内网渗透">CFS三层内网渗透</a><time datetime="2024-03-04T07:37:37.000Z" title="发表于 2024-03-04 15:37:37">2024-03-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/02/22/BP%E6%8F%92%E4%BB%B6-%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/" title="BP插件-验证码识别"><img src="https://ts1.cn.mm.bing.net/th/id/R-C.0c8ee0efd383f472ad05fd43ae70aec4?rik=qTV1mx7%2fXGqVPg&amp;riu=http%3a%2f%2fwww.quazero.com%2fuploads%2fallimg%2f140305%2f1-140305131419.jpg&amp;ehk=q6mPdCQsj5q2R99e%2bXVm6grd0l9KVDuaacWY98KujSc%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BP插件-验证码识别"/></a><div class="content"><a class="title" href="/2024/02/22/BP%E6%8F%92%E4%BB%B6-%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/" title="BP插件-验证码识别">BP插件-验证码识别</a><time datetime="2024-02-22T13:56:21.000Z" title="发表于 2024-02-22 21:56:21">2024-02-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://imgxz.bizhi3.com/cont/20220811/fll20l2e4ie.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024  <i id="heartbeat" class="fa fas fa-heartbeat"></i> willsafe</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.<p><a style="margin-inline:5px"target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"></a><a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"></a><a style="margin-inline:5px"target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="2771052201" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="true" muted></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script data-pjax defer src="https://npm.elemecdn.com/tzy-blog/lib/js/theme/chocolate.js"></script><script id="canvas_nest" defer="defer" color="67,233,186" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>